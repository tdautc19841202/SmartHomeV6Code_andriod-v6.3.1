<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
	<title>RoadTranslator_A2</title>
	<link rel="stylesheet" href="../../source/mui/css/mui.min.css">
	<link rel="stylesheet" href="../../source/mui/css/mui.picker.min.css">
	<link rel="stylesheet" type="text/css" href="css/base.css" />
	<link rel="stylesheet" type="text/css" href="../../skinSource/css/skin.css" />
	<script src="../../source/js/jquery-3.1.1.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="../../source/js/rem.js" type="text/javascript" charset="utf-8"></script>
	
	<style>
		.content {
			width: 100%;
			background: #f1f4f8;
		}

		.form-group {
			margin-bottom: 1.5rem;
		}
		
		.groupTwo {
			margin-top: 2.5rem;
		}

		.form-group .title {
			font-size: 1.5rem;
			color: #666;
			padding: 1rem 1.5rem;
		}

		.form-group .form-item {
			background-color: #fff;
			/*height: 4.5rem;*/ 
			line-height: 4.5rem;
			border-bottom: 1px solid #e3e3e3;
			padding: 0 1.5rem;
		}

		.form-group .form-item:first-child {
			border-top: 1px solid #e3e3e3;
		}
		
		.opearItem_one,
		.timeItem_one,
		.opearItem_two,
		.timeItem_two{
			display: none;
		}

		.form-group input,
		.form-group .label {
			font-size: 1.7rem;
			color: #444;
			line-height: inherit;
			height: inherit;
			margin: 0;
			padding: 0;
			border: hidden;
		}

		.form-group input:-moz-placeholder {
			color: #999;
			opacity: 1;
		}

		.form-group input::-moz-placeholder {
			color: #999;
			opacity: 1;
		}

		.form-group input:-ms-input-placeholder {
			color: #999;
			opacity: 1;
		}

		.form-group input::-webkit-input-placeholder {
			color: #999;
			opacity: 1;
		}

		.form-group .form-item .label {
			float: left;
		}

		.right-opre {
			float: right;
		}

		.right-opre .value {
			font-size: 1.5rem;
			color: #666;
		}

		.right-opre img {
			width: 1.1rem;
			height: 1.95rem;
			margin: -0.5rem 0 0 1rem;
			vertical-align: middle;
		}
		
		.switch{
	  		position:relative;
			float:right;
			width:4rem;
			height:2rem;
			padding:0.5rem;
			margin-top: 1.4rem;
			margin: 1.25rem 0 0.75rem 0;
			background:#aaa;
			border-radius:1.5rem;
		}
		.switch i{
			position:absolute;
			left:10%;
			top:13%;
			display:block;
			width:1.5rem;
			height:1.5rem;
			background:#fff;
			border-radius:50%;
		}
		.on{
			background:#8dd652;
		}
		.switch i.open{
			left: 50%;
		}
	</style>

</head>

<body>
	<header class="header">
		<div class="header_top">
			<a class="back" href="javascript:;"></a>
			<a href="javascript:;" class="autoSwitchLanguager" id="device_A2_button_name_status">按键名称与状态</a>
			<a class="autoSwitchLanguager save" href="javascript:;"  id="device_A2_save">保存</a>
		</div>
	</header>
	<div class="content">
		<div class="form-group">
			<p class="autoSwitchLanguager title" id="device_A2_name_1">名称</p>
			<div class='form-item clearfix'>
				<input id="nameInput" class="autoSwitchLanguager" type="text" maxlength="20" key="device_A2_enter_name" placeholder="请输入名称">
			</div>
		</div>
		<div class="form-group">
			<p class="autoSwitchLanguager title" id="device_A2_status">状态</p>
			<div class='form-item numItem_one clearfix'>
				<span class="autoSwitchLanguager label">一路</span>
				<div class="right-opre switch switch_one">
					<i data-state="off" id="on"></i>
				</div>
			</div>
			<div class='form-item opearItem_one clearfix'>
				<span class="autoSwitchLanguager label" key="device_A2_action">动作</span>
				<div class="right-opre actor">
					<span class="autoSwitchLanguager value" key="device_A2_action_close">闭合</span>
					<img src="fonts/icon_right.png" alt="">
				</div>
			</div>
			<div class='form-item timeItem_one clearfix'>
				<span class="autoSwitchLanguager label" key="device_A2_close_time">闭合时间</span>
				<div class="right-opre actor">
					<span class="value time_one">10s</span>
					<img src="fonts/icon_right.png" alt="">
				</div>
			</div>
		</div>
		
		<div class="form-group groupTwo">
			<div class='form-item numItem_two clearfix'>
				<span class="autoSwitchLanguager label">二路</span>
				<div class="right-opre switch switch_two">
					<i data-state="off" id="on"></i>
				</div>
			</div>
			<div class='form-item opearItem_two clearfix'>
				<span class="autoSwitchLanguager label" key="device_A2_action">动作</span>
				<div class="right-opre actor">
					<span class="autoSwitchLanguager value" key="device_A2_action_close">闭合</span>
					<img src="fonts/icon_right.png" alt="">
				</div>
			</div>
			<div class='form-item timeItem_two clearfix'>
				<span class="autoSwitchLanguager label" key="device_A2_close_time">闭合时间</span>
				<div class="right-opre actor">
					<span class="value">10s</span>
					<img src="fonts/icon_right.png" alt="">
				</div>
			</div>
		</div>
	</div>
	<script src="js/plus.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/tools.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/gatewayCmd.js" type="text/javascript" charset="utf-8"></script>
	<script src="lang/lang.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript" src="../../source/mui/js/mui.min.js"></script>
	<script type="text/javascript" src="../../source/mui/js/mui.picker.min.js"></script>
	<script type="text/javascript">
		
		initlan();
		var info = window.sysfun;
    		info.init("device_A2");
		var picker,picker2,picker3,picker4;
		var index = "";
		var name = "";
		var gwID;
		var devID;
		var epDataStr = "";
		var defaultOpear_one = 2;
		var defaultTime_one = "10";
		var defaultOpear_two = 2;
		var defaultTime_two = "10";
		
		plus.plusReady(function(){
			
			$(".numItem_one .label").html(1 + lang_A2_way);
			$(".numItem_two .label").html(2 + lang_A2_way);
			
			if(info.getItem("index") != undefined) {
				index  = info.getItem("index");
			}
			name  = info.getItem("name");
			epDataStr  = info.getItem("epData");
			gwID = info.getItem("gwID");
			devID = info.getItem("devID");
			if(index.length > 0) {
				
				if(epDataStr.length > 0) {
					if(epDataStr.substr(0,1) != "2") {
						defaultOpear_one = epDataStr.substr(0,1);
						defaultTime_one = epDataStr.substr(1,2);
					}
					if(epDataStr.substr(3,1) != "2") {
						defaultOpear_two = epDataStr.substr(3,1);
						defaultTime_two = epDataStr.substr(4,2);
					}
					refreshUI();
				}
			}
			
			plus.gatewayCmd.newDataRefresh(function (data) {
				if(data.cmd == "518" && devID == data.devID) {
					if(data.operType == 1 || data.operType == 3) {
						window.location = "roadTranslator.html";
//						plus.tools.back(function() {})
					}
				}
			})
		})

		
		function refreshUI() {
			
			if(name.length > 0) {
				$("#nameInput").val(name);
			}
			
			if(defaultOpear_one != 2) {
				$(".switch_one").addClass("on");
				$(".switch_one").find("i").addClass("open");
				$(".switch_one").find("i").attr("data-state", "on");
				$(".opearItem_one").show();
				var opearname = getOpearName(defaultOpear_one);
				$(".opearItem_one .value").html(opearname);
				if(defaultOpear_one > 2){
					$(".timeItem_one").show();
					$(".timeItem_one .right-opre").find("span").html(defaultTime_one + "s")
				}
				
			} 
			
			if(defaultOpear_two != 2) {
				$(".switch_two").addClass("on");
				$(".switch_two").find("i").addClass("open");
				$(".switch_two").find("i").attr("data-state", "on");
				$(".opearItem_two").show();
				var opearname = getOpearName(defaultOpear_two);
				$(".opearItem_two .value").html(opearname);
				if(defaultOpear_two > 2){
					$(".timeItem_two").show();
					$(".timeItem_two .right-opre").find("span").html(defaultTime_two + "s");
				}
			} 
		}
		
		function getArr(start, end) {
            var arr = [];
            for (var i = start; i <= end; i++) {
                if (i < 10) {
                    i = "0" + i;
                }
                arr.push({text:"" + i})
            }
            return arr;
        }
        
		$(".opearItem_one").find("span").on("click",function(){
         	var _this = $(this);
            if(!picker){
                picker = new mui.PopPicker({
                    layer: 1
                });
                picker.setData([{
                    value: "1",
                    text: lang_A2_action_close
                },{
                    value: "0",
                    text: lang_A2_action_open
                },{
                    value: "3",
                    text: lang_A2_action_open_close
                },{
                    value: "4",
                    text: lang_A2_action_close_open
				}]);
				$(".mui-poppicker-btn-cancel").html(lang_A2_cancel);
				$(".mui-poppicker-btn-ok").html(lang_A2_ok);
            }
			$(".mui-poppicker-clear").html(lang_A2_action);
			var index = getOpearIndex(defaultOpear_one);
            picker.pickers[0].setSelectedIndex(index);
            picker.show(function(item) {
                console.log(item);
                var windStr = item[0].text;
                var windSend = item[0].value;
                $(_this).html(windStr);
                defaultOpear_one = windSend;
                if(windSend == "3" || windSend == "4") {
                		if(windSend == "3") {
                			$(".timeItem_one .label").html(lang_A2_open_time);
                		} else {
                			$(".timeItem_one .label").html(lang_A2_close_time);
                		}
                		$(".timeItem_one").show();
                } else {
                		$(".timeItem_one").hide();
                }
            });
        });
        
        $(".timeItem_one").find("span").on("click",function(){
         	var _this = $(this);
            if(!picker2){
                picker2 = new mui.PopPicker({
                    layer: 1
                });
				picker2.setData(getArr(0,99));
				picker2.body.setAttribute('id', 'timePicker');
				$(".mui-backdrop").css("opacity", "0");
				$(".mui-poppicker-btn-cancel").html(lang_A2_cancel);
                $(".mui-poppicker-btn-ok").html(lang_A2_ok);
                var right = $("#timePicker .mui-picker").eq(0).find(".mui-pciker-rule-ft");
				right.html(lang_A2_s);
				var width = $("#timePicker .mui-pciker-rule-ft").width();
				$(right).css({
                    "text-indent": width * 3/ 5 + "px"
				});
			}
			if(defaultOpear_one == 3) {
				$(".mui-poppicker-clear").html(lang_A2_open_time);
			} else if(defaultOpear_one == 4){
				$(".mui-poppicker-clear").html(lang_A2_close_time);
			}
            picker2.pickers[0].setSelectedIndex(defaultTime_one);
            picker2.show(function(item) {
                console.log(item);
                var windStr = item[0].text;
                defaultTime_one = windStr;
                $(_this).html(windStr + "s");
            });
        });
        
        $(".opearItem_two").find("span").on("click",function(){
         	var _this = $(this);
            if(!picker3){
                picker3 = new mui.PopPicker({
                    layer: 1
                });
                picker3.setData([{
                    value: "1",
                    text: lang_A2_action_close
                },{
                    value: "0",
                    text: lang_A2_action_open
                },{
                    value: "3",
                    text: lang_A2_action_open_close
                },{
                    value: "4",
                    text: lang_A2_action_close_open
				}]);
				$(".mui-poppicker-btn-cancel").html(lang_A2_cancel);
				$(".mui-poppicker-btn-ok").html(lang_A2_ok);
			}
			$(".mui-poppicker-clear").html(lang_A2_action);
			var index = getOpearIndex(defaultOpear_two);
            picker3.pickers[0].setSelectedIndex(index);
            picker3.show(function(item) {
                console.log(item);
                var windStr = item[0].text;
                var windSend = item[0].value;
                $(_this).html(windStr);
                defaultOpear_two = windSend;
                if(windSend == "3" || windSend == "4") {
                	if(windSend == "3") {
                		$(".timeItem_two .label").html(lang_A2_open_time);
                	} else {
                		$(".timeItem_two .label").html(lang_A2_close_time);
                	}
                	$(".timeItem_two").show();
                } else {
                	$(".timeItem_two").hide();
                }
            });
        });
        
        $(".timeItem_two").find("span").on("click",function(){
         	var _this = $(this);
            if(!picker4){
                picker4 = new mui.PopPicker({
                    layer: 1
                });
				picker4.setData(getArr(0,99));
				picker4.body.setAttribute('id', 'timePicker2');
				$(".mui-backdrop").css("opacity", "0");
				$(".mui-poppicker-btn-cancel").html(lang_A2_cancel);
				$(".mui-poppicker-btn-ok").html(lang_A2_ok);
				var right = $("#timePicker2 .mui-picker").eq(0).find(".mui-pciker-rule-ft");
				right.html(lang_A2_s);
				var width = $("#timePicker2 .mui-pciker-rule-ft").width();
				$(right).css({
                    "text-indent": width * 3/ 5 + "px"
				});
			}
			if(defaultOpear_two == 3) {
				$(".mui-poppicker-clear").html(lang_A2_open_time);
			} else if(defaultOpear_two == 4){
				$(".mui-poppicker-clear").html(lang_A2_close_time);
			}
            picker4.pickers[0].setSelectedIndex(defaultTime_two);
            picker4.show(function(item) {
                console.log(item);
                var windStr = item[0].text;
                defaultTime_two = windStr;
                $(_this).html(windStr + "s");
            });
        });
        
		
		$(".back").on("click", function () {
			window.location = "roadTranslator.html";
//			plus.tools.back(function() {})
		})
		
		$(".switch_one").find("i").on("click", function() {
			var self = $(this)
			if($(this).attr("data-state") == "on") {
				$(".switch_one").removeClass("on");
				self.attr("data-state", "off");
				self.removeClass("open");
				$(".opearItem_one").hide();
				$(".timeItem_one").hide();
				defaultOpear_one = 2;
				defaultTime_one = 10;
				$(".opearItem_one .value").html(lang_A2_action_close);
			} else {
				$(".switch_one").addClass("on");
				self.addClass("open");
				self.attr("data-state", "on");
				$(".opearItem_one").show();
				defaultOpear_one = 1;
			}
		})
		$(".switch_two").find("i").on("click", function() {
			var self = $(this)
			if($(this).attr("data-state") == "on") {
				$(".switch_two").removeClass("on");
				self.attr("data-state", "off");
				self.removeClass("open");
				$(".opearItem_two").hide();
				$(".timeItem_two").hide();
				defaultOpear_two = 2;
				 defaultTime_two = 10;
				 $(".opearItem_one .value").html(lang_A2_action_close);
			} else {
				$(".switch_two").addClass("on");
				self.addClass("open");
				self.attr("data-state", "on");
				$(".opearItem_two").show();
				defaultOpear_two = 1;
			}
		})
		
		$(".save").on("click", function () {
			
			var name = $("#nameInput").val();
			
			if(name != undefined && name.length > 0) {
				if(defaultOpear_one <= 2) {
					defaultTime_one = "00";
				}
				if(defaultOpear_two <= 2) {
					defaultTime_two = "00";
				}
				if(index.length > 0) {
					var data = [];
					var dataDic = {};
					dataDic.index = index;
					dataDic.name = $("#nameInput").val();
					dataDic.epData = defaultOpear_one + defaultTime_one + defaultOpear_two + defaultTime_two;
					data.push(dataDic);
					send518Order(3, data);
				} else {
					var data = new Array();
					var dataDic = {};
					dataDic.name = $("#nameInput").val();
					dataDic.epData = defaultOpear_one + defaultTime_one + defaultOpear_two + defaultTime_two;
					data.push(dataDic);
					send518Order(1, data);
				}
			} else {
				alert(lang_A2_enter_name);
			}
		})
		
		function send518Order(operType, data) {
			var jsonData = {};
        		jsonData.cmd = "518";
        		jsonData.gwID = gwID;
        		jsonData.devID = devID;
        		jsonData.operType = operType;
        		jsonData.data = data;
       		plus.gatewayCmd.controlDevice(jsonData,function(){})
			
		}
		
		function getOpearName (opearType) {
			
			var operaName ;
			if(opearType == 0) {
				operaName = lang_A2_action_open;
			} else if(opearType == 1){
				operaName = lang_A2_action_close;
			} else if(opearType == 3){
				operaName = lang_A2_action_open_close;
			} else if(opearType == 4){
				operaName = lang_A2_action_close_open;
			}
			return operaName;
		}

		function getOpearIndex(opearValue) {
			var index;
			if(opearValue == 0) {
				index = 1;
			} else if(opearValue == 1 || opearValue == 2){
				index = 0;
			} else if(opearValue == 3){
				index = 2;
			} else if(opearValue == 4){
				index = 3;
			}
			return index;
		}
		
	</script>

</body>

</html>